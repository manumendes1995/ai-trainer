<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>AI Trainer</title>
  <meta name="theme-color" content="#0b1220"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" href="favicon.ico"/>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f1a33; --muted:#a3b3d8;
      --brand:#ffd54a; --accent:#5eead4; --danger:#ff6b6b; --ok:#67e480; --stroke:#1a2c59;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;color:#eaf1ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    body{background:#0b1220}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;z-index:30;background:#0b1220;border-bottom:1px solid #152445}
    .brand{display:flex;gap:10px;align-items:center;font-weight:800}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    nav a{padding:10px 12px;border-radius:10px;background:#0f1a33;color:#cfe1ff;border:1px solid #152445;text-decoration:none}
    nav a.active{background:#122044;color:#fff;border-color:#25407f}
    .card{border:1px solid var(--stroke);background:#0f1a33;border-radius:12px;padding:16px;margin-top:12px}
    .btn{padding:10px 12px;border-radius:10px;border:1px solid #25407f;background:#122044;color:#fff;cursor:pointer}
    .btn.ghost{background:transparent}
    .muted{color:#97a1c0}
    .hidden{display:none}
    video,canvas{width:100%;height:auto;border-radius:12px;border:1px solid var(--stroke);background:#000}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #25407f;background:#122044}
    footer{padding:24px;color:#8ca5d6;text-align:center}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">AI Trainer</div>
    <nav>
      <a href="#home"        data-tab="home"       class="active">Início</a>
      <a href="#camera"      data-tab="camera">Câmara</a>
      <a href="#treinos"     data-tab="treinos">Treinos</a>
      <a href="#alimentacao" data-tab="alimentacao">Alimentação</a>
      <a href="#conta"       data-tab="conta">Conta</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- HOME -->
  <section id="home" class="tab">
    <div class="card">
      <h1>Treina com IA</h1>
      <p class="muted">Correção de postura, contagem de repetições, planos de treino e cardápios com quantidades.</p>
      <div class="toolbar">
        <a class="btn" href="#conta">Criar conta</a>
        <a class="btn ghost" href="#camera">Abrir Câmara</a>
      </div>
    </div>
  </section>

  <!-- CÂMARA -->
  <section id="camera" class="tab hidden">
    <div class="card">
      <h2>Câmara + IA</h2>
      <div style="position:relative">
        <video id="cameraVideo" playsinline muted></video>
        <canvas id="cameraCanvas" style="position:absolute;left:0;top:0;"></canvas>
      </div>
      <div class="toolbar">
        <button id="btnStart" class="btn">Iniciar</button>
        <button id="btnStop" class="btn ghost">Parar</button>
        <select id="exercise" class="btn">
          <option value="arm-right">Braço direito</option>
          <option value="arm-left">Braço esquerdo</option>
          <option value="squat">Agachamento</option>
        </select>
        <span class="pill">Estado: <strong id="camStatus">parado</strong></span>
        <span class="pill">Reps: <strong id="reps">0</strong></span>
        <span class="pill">Dica: <strong id="tip">—</strong></span>
      </div>
      <p class="muted" style="margin-top:8px">Se a câmara não abrir no iPhone, usa o Safari e aceita a permissão.</p>
    </div>
  </section>

  <!-- TREINOS -->
  <section id="treinos" class="tab hidden">
    <div class="card">
      <h2>Planos de Treino</h2>
      <div class="toolbar">
        <label>Género:
          <select id="selGenero" class="btn">
            <option value="f">Feminino</option>
            <option value="m">Masculino</option>
          </select>
        </label>
        <label>Nível:
          <select id="selNivel" class="btn">
            <option value="iniciante">Iniciante (5 dias)</option>
            <option value="avancado">Avançado (6 dias)</option>
          </select>
        </label>
        <button id="btnVerPlano" class="btn">Ver Plano</button>
      </div>
      <div id="planoOut"></div>
    </div>
  </section>

  <!-- ALIMENTAÇÃO -->
  <section id="alimentacao" class="tab hidden">
    <div class="card">
      <h2>Cardápios com quantidades</h2>
      <div class="toolbar">
        <label>Objetivo:
          <select id="selObj" class="btn">
            <option value="emagrecimento">Emagrecimento</option>
            <option value="hipertrofia">Hipertrofia</option>
          </select>
        </label>
        <label>Tipo:
          <select id="selTipo" class="btn">
            <option value="omni">Omnívoro</option>
            <option value="vegetariano">Vegetariano</option>
            <option value="lactante">Lactante</option>
          </select>
        </label>
        <button id="btnVerMenu" class="btn">Ver Cardápio</button>
      </div>
      <div id="menuOut"></div>
    </div>
  </section>

  <!-- CONTA -->
  <section id="conta" class="tab hidden">
    <div class="card">
      <h2>Conta</h2>
      <p>Inscrição por email estará disponível no próximo passo. Por agora, usa as áreas gratuitas.</p>
      <a class="btn" href="#home">Voltar ao início</a>
    </div>
  </section>
</main>

<footer>© AI Trainer</footer>

<!-- TFJS + Pose Detection (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core@4.20.0/dist/tf-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter@4.20.0/dist/tf-converter.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl@4.20.0/dist/tf-backend-webgl.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.1.3/dist/pose-detection.min.js"></script>

<!-- App -->
<script src="ia.js"></script>

<script>
  // Tabs por hash
  const tabs = ["home","camera","treinos","alimentacao","conta"];
  function showTab(t){
    tabs.forEach(id=>{
      const sec=document.getElementById(id);
      if(sec) sec.classList.toggle("hidden", id!==t);
      document.querySelectorAll('nav a[data-tab]').forEach(a=>{
        a.classList.toggle("active", a.dataset.tab===t);
      });
    });
  }
  window.addEventListener("hashchange", ()=>{
    const t=(location.hash||"#home").slice(1);
    showTab(tabs.includes(t)?t:"home");
  });
  showTab((location.hash||"#home").slice(1)||"home");

  // Treinos
  document.getElementById("btnVerPlano")?.addEventListener("click", async ()=>{
    const genero=document.getElementById("selGenero").value;
    const nivel=document.getElementById("selNivel").value;
    const out=document.getElementById("planoOut");
    out.innerHTML="A carregar...";
    try{
      const data=await (await fetch("data/planos.json",{cache:"no-store"})).json();
      const bloco = data[genero==="f"?"feminino":"masculino"][nivel];
      let html=`<p class="muted">${bloco.cardio||""}</p>`;
      (bloco.dias||[]).forEach(d=>{
        html+=`<div class="card"><h3>${d.nome}</h3><ul>`+
              d.exercicios.map(x=>`<li>${x}</li>`).join("")+
              `</ul></div>`;
      });
      out.innerHTML=html;
    }catch(e){ console.error(e); out.innerHTML="<p class='muted'>Falha ao carregar plano.</p>"; }
  });

  // Cardápios
  document.getElementById("btnVerMenu")?.addEventListener("click", async ()=>{
    const obj=document.getElementById("selObj").value;
    const tipo=document.getElementById("selTipo").value;
    const out=document.getElementById("menuOut");
    out.innerHTML="A carregar...";
    try{
      const data=await (await fetch("data/menus.json",{cache:"no-store"})).json();
      const bloco = data[obj][tipo];
      let html=`<p class="muted">${bloco.kcal||""}</p>`;
      (bloco.refeicoes||[]).forEach(r=>{
        html+=`<div class="card"><h3>${r.nome}</h3><ul>`+
              r.itens.map(x=>`<li>${x}</li>`).join("")+
              `</ul></div>`;
      });
      out.innerHTML=html;
    }catch(e){ console.error(e); out.innerHTML="<p class='muted'>Falha ao carregar cardápio.</p>"; }
  });
</script>
</body>
</html>
